import{q as z,k as re,l as le,p as E,K as ie,D as H,U as ae,c as l,z as d,J as w,X as F,r as se,L as O,H as k,M as h,B as u,A as P,$ as oe,S as J,V as q}from"./routing-D8Du2lqM.js";import{c as A,a as K,T,r as C,L as ce,g as ue,l as de}from"./Time-MdJmrkwJ.js";const me=z;function ge(t,i,n,c){return t.addEventListener(i,n,c),me(t.removeEventListener.bind(t,i,n,c))}function fe(t,i=re()){let n=0,c,s;return()=>(n++,z(()=>{n--,queueMicrotask(()=>{!n&&s&&(s(),s=c=void 0)})}),s||le(g=>c=t(s=g),i),c)}const he=fe(()=>{const[t,i]=E(null);return ge(window,"keydown",n=>{i(n),setTimeout(()=>i(null))}),t});var N=d("<audio>"),ve=d('<div class="flex flex-col items-center gap-2"><div class="h-4 w-4 animate-spin rounded-full border-2 border-blue-500 border-t-transparent">'),xe=d('<button class="cursor-pointer text-lg underline">Pause'),pe=d('<button class="cursor-pointer text-lg underline">Play'),ye=d('<div class="flex h-full flex-row items-center justify-between bg-blue-100 px-4 text-4xl font-bold text-blue-950"><div>'),$e=d('<div class="flex flex-col gap-2"><div class="flex flex-row items-center justify-between"><button class="cursor-pointer text-lg underline">Back 10s</button><button class="cursor-pointer text-lg underline">Back</button><button class="cursor-pointer text-lg underline">Next</button><button class="cursor-pointer text-lg underline">Forward 10s'),be=d('<div class="flex h-full flex-row items-center justify-between bg-green-100 px-4 text-4xl font-bold text-green-950 opacity-60"><div>'),we=d('<div class="flex h-full flex-row items-center justify-between bg-gray-100 px-4 text-4xl font-bold text-gray-950 opacity-60"><div>'),_e=d('<div class="absolute inset-0">'),Ie=d("<div><div>"),Se=d('<div class="absolute inset-0 bg-white opacity-[var(--opacity)]">');function Ce(){let t,i;const n=ie(),[c,s]=E(!0),[g,p]=A([]),[y,R]=E(0),[a,m]=A({playing:!1,itemIndex:0,time:0}),_=()=>g.find(e=>e.id===n.id),v=()=>_()?.items??[],x=()=>v()[a.itemIndex],L=()=>{const e=_();return e?ue(e):0},B=()=>{let e=a.time;for(let r=0;r<a.itemIndex;r++)e+=v()[r].duration;return e},U=()=>{if(!a.playing)return;const e=x();e&&(a.time>=e.duration-5&&a.time<e.duration&&(R(1),a.time===e.duration-1?i.play():t.play()),a.time>=e.duration?a.itemIndex===v().length-1?V():D(0):G())},V=()=>{m(e=>({...e,playing:!1,itemIndex:0,time:0}))},X=()=>{const e=Math.max(0,a.itemIndex-1);m(r=>({...r,itemIndex:e,time:0}))},D=e=>{const r=Math.min(a.itemIndex+1,v().length-1);m($=>({...$,itemIndex:r,time:e??0}))},G=()=>{m(e=>({...e,time:e.time+1}))},Q=()=>{const e=Math.max(0,a.time-10);m(r=>({...r,time:e}))},W=()=>{const e=Math.min(a.time+10,x()?.duration??0);m(r=>({...r,time:e}))},Y=()=>{m(e=>({...e,playing:!1}))},Z=()=>{m(e=>({...e,playing:!0}))},ee=()=>{m(e=>({...e,playing:!e.playing}))};H(()=>{p(de()),s(!1);const e=setInterval(()=>{U()},1e3);return()=>clearInterval(e)});const te=he();return ae(()=>{const e=te();e?.code==="Space"&&(ee(),e.preventDefault())}),[(()=>{var e=N(),r=t;return typeof r=="function"?F(r,e):t=e,w(()=>O(e,"src",K("short.mp3"))),e})(),(()=>{var e=N(),r=i;return typeof r=="function"?F(r,e):i=e,w(()=>O(e,"src",K("long.mp3"))),e})(),l(ce,{get children(){return l(k,{get children(){return[l(h,{get when(){return c()},get children(){return ve()}}),l(h,{get when(){return!c()},get children(){var e=$e(),r=e.firstChild,$=r.firstChild,j=$.nextSibling,I=j.nextSibling,ne=I.nextSibling;return $.$$click=Q,j.$$click=X,u(r,l(k,{get children(){return[l(h,{get when(){return a.playing},get children(){var o=xe();return o.$$click=Y,o}}),l(h,{get when(){return!a.playing},get children(){var o=pe();return o.$$click=Z,o}})]}}),I),I.$$click=()=>D(),ne.$$click=W,u(e,l(M,{class:"opacity-70",color2:"bg-blue-400",get time(){return B()},get duration(){return L()},get children(){var o=ye(),b=o.firstChild;return u(b,()=>_()?.name??""),u(o,l(T,P(()=>C(L()-B()))),null),o}}),null),u(e,l(oe,{get each(){return v()},children:(o,b)=>l(k,{get children(){return[l(h,{get when(){return b()===a.itemIndex},get children(){return l(M,{class:"border-3 border-green-300",color2:"bg-green-400",get time(){return a.time},get duration(){return x()?.duration??0},get children(){var f=be(),S=f.firstChild;return u(S,()=>x()?.name??""),u(f,l(T,P(()=>C((x()?.duration??0)-a.time))),null),f}})}}),l(h,{get when(){return b()!==a.itemIndex},get children(){return l(M,{class:"border-3 border-dashed border-gray-300 opacity-50",color2:"bg-gray-400",time:0,get duration(){return o.duration},get children(){var f=we(),S=f.firstChild;return u(S,()=>o.name??""),u(f,l(T,P(()=>C(o.duration))),null),f}})}})]}})}),null),e}})]}})}}),l(ke,{get opacity(){return y()},setOpacity:R})]}function M(t){const i=()=>`${t.time/t.duration*100}%`;return(()=>{var n=Ie(),c=n.firstChild;return c.style.setProperty("width","var(--width)"),u(n,l(J,{get when(){return t.children},get children(){var s=_e();return u(s,()=>t.children),s}}),null),w(s=>{var g=i(),p="relative h-[64px] w-full "+t.class,y="h-full "+t.color2;return g!==s.e&&((s.e=g)!=null?n.style.setProperty("--width",g):n.style.removeProperty("--width")),p!==s.t&&q(n,s.t=p),y!==s.a&&q(c,s.a=y),s},{e:void 0,t:void 0,a:void 0}),n})()}function ke(t){return H(()=>{const i=setInterval(()=>{t.setOpacity(n=>Math.max(0,n-.04))},16);return()=>clearInterval(i)}),l(J,{get when(){return t.opacity>0},get children(){var i=Se();return w(n=>(n=t.opacity)!=null?i.style.setProperty("--opacity",n):i.style.removeProperty("--opacity")),i}})}se(["click"]);export{Ce as default};
